import{S as L,i as M,s as H,k as P,q as S,a as O,l as v,m as k,r as C,h as o,c as T,n as b,b as h,E as w,O as q,Q as A,V as J,F as B,R as K,o as Q}from"../chunks/index.ba8c4f3a.js";import{g as Y}from"../chunks/navigation.640da136.js";import{l as z,P as D}from"../chunks/public.56157045.js";function F(c){let t,a;return{c(){t=P("p"),a=S("Payment failed. Please try again."),this.h()},l(l){t=v(l,"P",{class:!0});var n=k(t);a=C(n,"Payment failed. Please try again."),n.forEach(o),this.h()},h(){b(t,"class","error svelte-4i9m9b")},m(l,n){h(l,t,n),w(t,a)},d(l){l&&o(t)}}}function G(c){let t;return{c(){t=S("Pay with WeChat Pay")},l(a){t=C(a,"Pay with WeChat Pay")},m(a,l){h(a,t,l)},d(a){a&&o(t)}}}function X(c){let t;return{c(){t=S("Processing...")},l(a){t=C(a,"Processing...")},m(a,l){h(a,t,l)},d(a){a&&o(t)}}}function Z(c){let t,a,l,n,m,y,E,d,f,s,p,u,W,g,r=c[0]&&F();function R(e,i){return e[1]?X:G}let I=R(c),_=I(c);return{c(){t=P("h1"),a=S("WeChat Pay Example"),l=O(),n=P("nav"),m=P("a"),y=S("View code"),E=O(),r&&r.c(),d=O(),f=P("form"),s=P("input"),p=O(),u=P("button"),_.c(),this.h()},l(e){t=v(e,"H1",{});var i=k(t);a=C(i,"WeChat Pay Example"),i.forEach(o),l=T(e),n=v(e,"NAV",{});var U=k(n);m=v(U,"A",{href:!0});var V=k(m);y=C(V,"View code"),V.forEach(o),U.forEach(o),E=T(e),r&&r.l(e),d=T(e),f=v(e,"FORM",{class:!0});var N=k(f);s=v(N,"INPUT",{name:!0,placeholder:!0,type:!0,class:!0}),p=T(N),u=v(N,"BUTTON",{class:!0});var j=k(u);_.l(j),j.forEach(o),N.forEach(o),this.h()},h(){b(m,"href","https://github.com/joshnuss/svelte-stripe/tree/main/src/routes/examples/wechat-pay"),b(s,"name","email"),b(s,"placeholder","E-mail"),b(s,"type","email"),s.disabled=c[1],b(s,"class","svelte-4i9m9b"),u.disabled=c[1],b(u,"class","svelte-4i9m9b"),b(f,"class","svelte-4i9m9b")},m(e,i){h(e,t,i),w(t,a),h(e,l,i),h(e,n,i),w(n,m),w(m,y),h(e,E,i),r&&r.m(e,i),h(e,d,i),h(e,f,i),w(f,s),q(s,c[2]),w(f,p),w(f,u),_.m(u,null),W||(g=[A(s,"input",c[4]),A(f,"submit",J(c[3]))],W=!0)},p(e,[i]){e[0]?r||(r=F(),r.c(),r.m(d.parentNode,d)):r&&(r.d(1),r=null),i&2&&(s.disabled=e[1]),i&4&&s.value!==e[2]&&q(s,e[2]),I!==(I=R(e))&&(_.d(1),_=I(e),_&&(_.c(),_.m(u,null))),i&2&&(u.disabled=e[1])},i:B,o:B,d(e){e&&o(t),e&&o(l),e&&o(n),e&&o(E),r&&r.d(e),e&&o(d),e&&o(f),_.d(),W=!1,K(g)}}}function x(c,t,a){let l=null,n=null,m=!1,y;Q(async()=>{l=await z(D);const s=new URLSearchParams(window.location.search);a(0,n=s.get("error"))});async function E(){const s=await fetch("/examples/wechat-pay/payment-intent",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:y})}),{clientSecret:p}=await s.json();return p}async function d(){if(m)return;a(1,m=!0);const s=await E(),p=await l.confirmWechatPayPayment(s,{payment_method_options:{wechat_pay:{client:"web"}}});console.log({result:p}),p.paymentIntent.last_payment_error?(a(0,n=p.paymentIntent.last_payment_error.message),a(1,m=!1)):Y("/examples/wechat-pay/thanks")}function f(){y=this.value,a(2,y)}return[n,m,y,d,f]}class ae extends L{constructor(t){super(),M(this,t,x,Z,H,{})}}export{ae as component};
